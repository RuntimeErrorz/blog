---
layout: post
title: ! 'RAFT: Recurrent All-Pairs Field Transforms for Optical Flow' 
subtitle: è®ºæ–‡å†™ä½œæœ‰ç‚¹ç¥ç§˜
author: RuntimeEroor
categories: æ·±åº¦å­¦ä¹ 
tags: å…‰æµä¼°è®¡ ECCV2020
---
## 1. Contribution
1. RAFT maintains and updates a single fixed flow field at high resolution.
2. The update operator of RAFT is recurrent and lightweight
3. The update operator consists of a convolutional GRU that performs lookups on 4D multi-scale correlation volumes (DualRefine's reference)

## 2. Optic Flow? (ä¸ºä»€ä¹ˆå®šä¹‰éƒ½ä¼šä¸‹é”™å•Šï¼Ÿ)
![1691399723052](/static//1691399723052.png)

## 3. Approach
### 3.1 Correaltion Pyramid and Computation
![1691399884598](/static//1691399884598.png)
![1691399930303](/static//1691399930303.png)
1. æˆ‘ä»¬ä¿æŒäº†é«˜åˆ†è¾¨ç‡ä¿¡æ¯(C^1, C^2)ï¼Œä½¿æˆ‘ä»¬çš„æ–¹æ³•èƒ½å¤Ÿæ¢å¤å¿«é€Ÿç§»åŠ¨çš„å°ç‰©ä½“çš„è¿åŠ¨ã€‚C^né€šè¿‡å¹³å‡æ± åŒ–æ¥æ„å»ºçš„ã€‚

2. é‚»åŸŸä¸Šçš„ç‚¹æ˜¯I_1ä¸Šçš„ç‚¹åˆ°I_2ä¸Šçš„æ½œåœ¨ä½ç½®ï¼Œåœ¨è¿­ä»£è®¡ç®—çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è®¡ç®—Xå’Œé¢†åŸŸå†…ç‚¹çš„ç›¸å…³æ€§ï¼Œå¯ä»¥ç›´æ¥æŸ¥è¯¢å‡ºæ¥ã€‚ï¼ˆåŒçº¿æ€§é‡‡æ ·ï¼‰

3. æˆ‘ä»¬åœ¨é‡‘å­—å¡”çš„æ‰€æœ‰å±‚çº§ä¸Šè¿›è¡ŒæŸ¥æ‰¾ï¼Œè¿™æ ·å±‚çº§ k çš„ç›¸å…³å· Ck å°±å¯ä»¥ä½¿ç”¨ç½‘æ ¼ N (xâ€²/2^k)r è¿›è¡Œç´¢å¼•ã€‚å„å±‚æ¬¡çš„åŠå¾„æ’å®šæ„å‘³ç€è¾ƒä½å±‚æ¬¡çš„ä¸Šä¸‹æ–‡æ›´å¤§ï¼šå¯¹äºæœ€ä½å±‚ k = 4ï¼ŒåŠå¾„ä¸º 4 ç›¸å½“äºåŸå§‹åˆ†è¾¨ç‡ä¸‹ 256 ï¼ˆç¡®å®šä¸æ˜¯ä¸€ä¸ªåƒç´ å…ˆå¯¹åº”äº†é«˜åˆ†è¾¨ç‡çš„64ä¸ªï¼Œç„¶åå†ä¹˜ä»¥16=1024ï¼Ÿï¼‰ä¸ªåƒç´ çš„èŒƒå›´ã€‚ç„¶åå°†å„å±‚æ¬¡çš„å€¼ä¸²è”æˆä¸€å¼ ç‰¹å¾å›¾ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œ åœ¨è¶Šä½åˆ†è¾¨ç‡çš„ correlation çŸ©é˜µä¸Š lookup åˆ°çš„ç»“æœï¼Œå…¶åœ¨è¯­ä¹‰å±‚é¢ä¸ŠåŒ…å«çš„ receptive field è¶Šå¹¿ã€‚

4. ç”¨å†…ç§¯çš„çº¿æ€§å’Œå¹³å‡æ± åŒ–ï¼Œå®ç° O(NM) çš„æ—¶é—´å¤æ‚åº¦ã€‚å®é™…ä¸Šè®¡ç®—çš„æ˜¯ g1 å’Œ m æ¬¡å¹³å‡æ± åŒ–ä¸‹é‡‡æ ·åçš„å†…ç§¯ï¼ˆå…ˆè®¡ç®—é«˜åˆ†è¾¨ç‡ç„¶åå¹³å‡æ± åŒ– correlation å’Œ å…ˆæ± åŒ– feature åè®¡ç®—ï¼‰ã€‚æˆ‘ä»¬ä¸é¢„å…ˆè®¡ç®—ç›¸å…³æ€§ï¼Œè€Œæ˜¯é¢„å…ˆè®¡ç®—æ± åŒ–çš„çš„å›¾åƒç‰¹å¾å›¾ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬åªåœ¨éœ€è¦æŸ¥æ‰¾æ—¶è®¡ç®—æ¯ä¸ªç›¸å…³å€¼ã€‚è¿™æ ·çš„å¤æ‚åº¦ä¸º O(NM)ï¼Ÿ
ç”±äº GPU ä¸Šçš„çŸ©é˜µä¾‹ç¨‹ç»è¿‡äº†é«˜åº¦ä¼˜åŒ–ï¼Œå› æ­¤é¢„è®¡ç®—æ‰€æœ‰é…å¯¹å¾ˆå®¹æ˜“å®ç°ã€‚ï¼ˆğŸ˜„ï¼‰
    > Github: this implementation is somewhat slower than all-pairs, but uses significantly less GPU memory during the forward pass.

### 3.2 Iterative Updates
![1691400324061](/static//1691400324061.png)
è®ºæ–‡ä¸­å…³äº $x_t$ çš„è¡¨è¿°ä¸å¦‚çœ‹å›¾ï¼Œç»™å®šå½“å‰æµé‡ä¼°è®¡å€¼ $f_k$ åï¼Œæˆ‘ä»¬å°†åˆ©ç”¨è¯¥ä¼°è®¡å€¼ä»ç›¸å…³é‡‘å­—å¡”ä¸­æå–ç›¸å…³ç‰¹å¾ï¼Œå¦‚ 3.2 èŠ‚æ‰€è¿°ã€‚ç„¶åç”± 2 ä¸ªå·ç§¯å±‚å¯¹ç›¸å…³ç‰¹å¾è¿›è¡Œå¤„ç†ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°† 2 ä¸ªå·ç§¯å±‚åº”ç”¨äºå…‰æµä¼°è®¡æœ¬èº«ï¼Œä»¥ç”Ÿæˆæµé‡ç‰¹å¾ã€‚æœ€åï¼Œæˆ‘ä»¬ç›´æ¥æ³¨å…¥ä¸Šä¸‹æ–‡ç½‘ç»œçš„è¾“å…¥ã€‚$x_t$ å°±æ˜¯ç›¸å…³ç‰¹å¾ï¼ˆæ¯å±‚çš„lookup concatenatedï¼‰ã€æµé‡ç‰¹å¾å’Œä¸Šä¸‹æ–‡ç‰¹å¾çš„é›†åˆã€‚

![1691400404880](/static//1691400404880.png)

### 3.3 Loss Function
![1691400554194](/static//1691400554194.png)
è¿­ä»£å‰æœŸçš„æƒé‡æ¯”è¾ƒä½ã€‚
## 4. Experiment
![1691400681973](/static//1691400681973.png)
## 4.1 Ablation
![1691400744502](/static//1691400744502.png)
- Feature Scaleï¼šæ˜¯å¦åŸºäºå¤šä¸ª scale çš„ featureå»æ„é€  Correlation Pyramid è€Œä¸æ˜¯å¹³å‡æ± åŒ–ã€‚
- Tied Weights: ![1691400767150](/static//1691400767150.png)

![1691400775732](/static//1691400775732.png)
- Features for refinementï¼šä½¿ç”¨å½“å‰çš„å…‰æµä¼°è®¡å€¼å°† I2 ä¸­çš„ç‰¹å¾ warp åˆ° I1 ä¸Šï¼Œç„¶åæ ¹æ®residualæ¥ä¼˜åŒ–ï¼ˆè‡ªç›‘ç£æ·±åº¦ä¼°è®¡æ˜¯å§ï¼‰ã€‚
- convex upsampling: 
- Inference updates: æ¨ç†çš„æ—¶å€™å¤šæ¨ç†ä¸ä¼šå‘æ•£ï¼Œå¾ˆå¿«å°±æ”¶æ•›äº†ã€‚